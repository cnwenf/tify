# 图片翻译保护器 (Image Translation Protector)

## 问题描述

Chrome浏览器的翻译功能在翻译网页时会导致图片丢失。例如，当页面包含图片链接时：

**翻译前：**
```html
<a href="/path/to/image.png">
  <img src="/path/to/image.png" alt="architecture" style="max-width: 100%;">
</a>
```

**翻译后：**
图片完全消失，只保留翻译后的文本内容。

## 解决方案

本项目提供了两种解决方案来防止Chrome翻译时图片丢失：

### 方案一：Chrome扩展 (推荐)

#### 安装步骤：

1. **下载扩展文件**
   - 下载本项目的所有文件到本地文件夹

2. **加载扩展**
   - 打开Chrome浏览器
   - 访问 `chrome://extensions/`
   - 启用"开发者模式"（右上角开关）
   - 点击"加载已解压的扩展程序"
   - 选择包含扩展文件的文件夹

3. **使用扩展**
   - 扩展会自动运行，无需手动操作
   - 点击扩展图标可查看状态和手动控制
   - 在翻译前会自动保存图片信息
   - 翻译后会自动恢复丢失的图片

#### 功能特性：

- ✅ **自动检测翻译**：实时监测Chrome翻译活动
- ✅ **智能图片保存**：在翻译前保存所有图片信息
- ✅ **自动恢复**：翻译后自动恢复丢失的图片
- ✅ **手动控制**：提供手动恢复和刷新功能
- ✅ **状态显示**：实时显示保护状态和统计信息

### 方案二：用户脚本 (Tampermonkey)

如果不想安装扩展，可以使用Tampermonkey用户脚本：

#### 安装步骤：

1. **安装Tampermonkey**
   - 在Chrome扩展商店搜索并安装"Tampermonkey"

2. **安装用户脚本**
   - 打开`image-translation-protector.user.js`文件
   - 复制所有内容
   - 在Tampermonkey中创建新脚本并粘贴代码
   - 保存并启用脚本

3. **使用脚本**
   - 访问任意网页，右上角会显示"🖼️ 图片保护"按钮
   - 点击按钮可打开控制面板
   - 脚本会自动保护和恢复图片

## 工作原理

### 1. 图片信息保存
- 页面加载时扫描所有`<img>`标签
- 保存图片的`src`、`alt`、`style`等属性
- 记录图片的父级链接信息（如果存在）
- 保存图片在DOM中的位置信息

### 2. 翻译检测
- 监听DOM变化事件
- 检测翻译相关的CSS类名和属性：
  - `[data-ai-translated="true"]`
  - `.ai-translation-immersive`
  - Google翻译相关类名

### 3. 图片恢复
- **基于内容匹配**：分析翻译容器的原始文本
- **智能位置推断**：根据关键词找到合适的插入位置
- **完整结构恢复**：恢复图片及其父级链接

### 4. 实时监控
- 使用`MutationObserver`监听DOM变化
- 定期检查翻译状态和图片完整性
- 自动触发恢复机制

## 技术特点

- **无侵入性**：不修改原始页面结构
- **高兼容性**：支持各种网站和图片格式
- **智能识别**：能识别多种翻译插件和场景
- **性能优化**：使用防抖和缓存机制
- **用户友好**：提供直观的状态显示和手动控制

## 支持的翻译场景

- ✅ Chrome内置翻译功能
- ✅ Google翻译扩展
- ✅ 其他基于DOM修改的翻译插件
- ✅ 沉浸式翻译扩展

## 测试案例

使用提供的示例HTML可以测试扩展效果：

1. 打开包含图片的网页
2. 使用Chrome翻译功能翻译页面
3. 观察图片是否被自动恢复

## 故障排除

### 图片未恢复？
1. 检查扩展是否正常加载
2. 查看浏览器控制台是否有错误信息
3. 尝试手动点击"手动恢复"按钮
4. 确认图片URL是否可访问

### 扩展无法加载？
1. 确认已启用"开发者模式"
2. 检查manifest.json格式是否正确
3. 查看扩展管理页面的错误信息

### 用户脚本不工作？
1. 确认Tampermonkey已正确安装
2. 检查脚本是否已启用
3. 刷新页面重新加载脚本

## 贡献

欢迎提交Issue和Pull Request来改进这个项目！

## 许可证

MIT License