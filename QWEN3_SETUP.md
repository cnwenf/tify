# 阿里云百炼 Qwen3 API 配置指南

## 🔧 修复内容

已修复 Qwen3 API 调用中的以下问题：

1. **模型名称错误**：从 `qwen-turbo` 更正为 `qwen3-235b-a22b-instruct-2507`
2. **请求参数优化**：添加了 `top_p` 和 `result_format` 参数
3. **错误处理增强**：提供更详细的错误信息
4. **响应解析改进**：支持多种响应格式

## 📋 配置步骤

### 1. 获取 API Key

1. 访问 [阿里云百炼控制台](https://dashscope.console.aliyun.com/)
2. 注册/登录阿里云账户
3. 创建 API Key
4. 确保账户有足够的余额

### 2. 扩展配置

1. 打开 Tidy 扩展弹窗
2. 选择 "阿里云百炼 Qwen3" 模型
3. 在 API 设置中输入你的 API Key
4. 点击 "测试" 按钮验证连接

### 3. 验证配置

- ✅ API Key 格式正确
- ✅ 账户有足够余额
- ✅ API 权限正常
- ✅ 网络连接正常

## 🔍 常见错误及解决方案

### 401 错误 - 认证失败

**可能原因：**
- API Key 错误或过期
- API Key 权限不足
- 账户余额不足

**解决方案：**
1. 检查 API Key 是否正确复制
2. 确认账户余额充足
3. 检查 API Key 权限设置

### 400 错误 - 请求格式错误

**可能原因：**
- 模型名称错误
- 请求参数格式不正确

**解决方案：**
- 已修复模型名称为 `qwen3-235b-a22b-instruct-2507`
- 确保使用最新版本的扩展

### 429 错误 - 请求频率限制

**解决方案：**
- 降低翻译频率
- 检查账户使用限制

## 📊 API 调用格式

### 请求格式

```json
{
  "model": "qwen3-235b-a22b-instruct-2507",
  "input": {
    "messages": [
      {
        "role": "user",
        "content": "请将以下文本从英语翻译成中文，只返回翻译结果：Hello, world!"
      }
    ]
  },
  "parameters": {
    "max_tokens": 1000,
    "temperature": 0.3,
    "top_p": 0.8,
    "result_format": "message"
  }
}
```

### 响应格式

```json
{
  "output": {
    "choices": [
      {
        "message": {
          "content": "你好，世界！"
        }
      }
    ]
  }
}
```

## 🧪 测试方法

### 1. 使用测试页面

1. 打开 `test_extension.html`
2. 配置 Qwen3 API
3. 测试翻译功能

### 2. 使用测试脚本

```javascript
// 在浏览器控制台中运行
testQwen3API();
```

### 3. 扩展内置测试

1. 在扩展弹窗中点击 "测试" 按钮
2. 观察测试结果

## 📝 注意事项

1. **API Key 安全**：不要在公开场合分享你的 API Key
2. **使用限制**：注意 API 调用频率和费用
3. **模型选择**：确保选择正确的模型名称
4. **网络环境**：确保网络连接稳定

## 🔄 更新日志

- **v1.0.0**：修复 Qwen3 模型名称和 API 调用格式
- 添加详细的错误处理和日志记录
- 优化响应解析逻辑

## 📞 技术支持

如果遇到问题，请：

1. 检查控制台错误信息
2. 验证 API Key 配置
3. 确认网络连接
4. 查看账户余额和权限

---

**最后更新：** 2024年12月
