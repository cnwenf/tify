<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tidy - 世界最好的AI翻译插件</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="popup-container">
    <!-- 头部 -->
    <header class="popup-header">
      <div class="logo">
        <img src="../assets/icon32.png" alt="Tidy" class="logo-icon">
        <h1>Tidy</h1>
        <span class="version">v2.0</span>
      </div>
      <div class="status-indicator" id="statusIndicator">
        <span class="status-dot"></span>
        <span class="status-text">就绪</span>
      </div>
    </header>

    <!-- 主要控制面板 -->
    <main class="popup-main">
      <!-- 翻译服务选择 -->
      <div class="control-section">
        <label for="aiModel" class="section-label">
          <span class="label-icon">🌐</span>
          翻译服务
        </label>
        <select id="aiModel" class="model-select">
          <option value="">加载中...</option>
        </select>
        <div id="modelInfo" class="model-info"></div>
        
        <!-- API Key 配置 (根据选择的翻译服务动态显示) -->
        <div id="apiKeySection" class="api-key-section" style="display: none;">
          <label for="apiKey" class="section-label">
            <span class="label-icon">🔑</span>
            API Key
          </label>
          <div class="input-group">
            <input type="password" id="apiKey" class="api-input" placeholder="请输入您的API密钥">
            <button id="toggleApiKey" class="toggle-password-btn" title="显示/隐藏密钥">👁️</button>
            <button id="testApiBtn" class="test-btn">测试连接</button>
          </div>
          <div class="api-help">
            <small id="apiKeyHelp">请输入对应服务的API密钥</small>
          </div>
        </div>
        
        <!-- Ollama模型子选择 -->
        <div id="ollamaModelSection" class="ollama-model-section" style="display: none;">
          <label for="ollamaModel" class="section-label">
            <span class="label-icon">🦙</span>
            Ollama 模型
          </label>
          <select id="ollamaModel" class="model-select">
            <option value="">检测本地模型...</option>
          </select>
          <button id="refreshOllamaModels" class="refresh-button">🔄 刷新</button>
        </div>
        
        <!-- 自定义端点 (可选) -->
        <div id="customEndpointSection" class="custom-endpoint-section" style="display: none;">
          <label for="customEndpoint" class="section-label">
            <span class="label-icon">🔗</span>
            自定义端点 (可选)
          </label>
          <input type="url" id="customEndpoint" class="api-input" placeholder="https://api.example.com/v1/chat/completions">
          <div class="api-help">
            <small>用于代理服务或私有部署</small>
          </div>
        </div>
      </div>

      <!-- 语言设置 -->
      <div class="control-section">
        <div class="language-settings">
          <div class="language-pair">
            <label for="sourceLang" class="section-label">
              <span class="label-icon">📄</span>
              源语言
            </label>
            <select id="sourceLang" class="lang-select">
              <option value="auto">🌐 自动检测</option>
              <option value="en">🇺🇸 English</option>
              <option value="zh">🇨🇳 中文</option>
              <option value="ja">🇯🇵 日本語</option>
              <option value="ko">🇰🇷 한국어</option>
              <option value="fr">🇫🇷 Français</option>
              <option value="de">🇩🇪 Deutsch</option>
              <option value="es">🇪🇸 Español</option>
              <option value="ru">🇷🇺 Русский</option>
              <option value="it">🇮🇹 Italiano</option>
              <option value="pt">🇵🇹 Português</option>
              <option value="ar">🇸🇦 العربية</option>
            </select>
          </div>
          <div class="language-arrow">
            <span class="arrow-icon">→</span>
          </div>
          <div class="language-pair">
            <label for="targetLang" class="section-label">
              <span class="label-icon">🎯</span>
              目标语言
            </label>
            <select id="targetLang" class="lang-select">
              <option value="zh">🇨🇳 中文</option>
              <option value="en">🇺🇸 English</option>
              <option value="ja">🇯🇵 日本語</option>
              <option value="ko">🇰🇷 한국어</option>
              <option value="fr">🇫🇷 Français</option>
              <option value="de">🇩🇪 Deutsch</option>
              <option value="es">🇪🇸 Español</option>
              <option value="ru">🇷🇺 Русский</option>
              <option value="it">🇮🇹 Italiano</option>
              <option value="pt">🇵🇹 Português</option>
              <option value="ar">🇸🇦 العربية</option>
            </select>
          </div>
        </div>
      </div>

      <!-- 翻译模式 - 简化为两种模式 -->
      <div class="control-section">
        <label class="section-label">
          <span class="label-icon">✨</span>
          翻译显示模式
          <span class="help-icon" title="选择翻译内容的显示方式"></span>
        </label>
        <div class="mode-options">
          <label class="mode-card">
            <input type="radio" name="translateMode" value="immersive-bilingual" checked>
            <div class="mode-content">
              <div class="mode-title">
                双语对照
              </div>
            </div>
          </label>
          
          <label class="mode-card">
            <input type="radio" name="translateMode" value="replace">
            <div class="mode-content">
              <div class="mode-title">
                直接翻译
                <span class="mode-help-icon" title="直接替换原文，鼠标悬停显示原文"></span>
              </div>
            </div>
          </label>
        </div>
      </div>

      <!-- 翻译设置 -->
      <div class="control-section">
        <label class="section-label">
          <span class="label-icon">⚡</span>
          翻译设置
        </label>
        <div class="setting-group">
          <div class="setting-item">
            <label for="concurrencyLimit" class="setting-label">并发数量</label>
            <select id="concurrencyLimit" class="setting-select">
              <option value="3">3 (保守)</option>
              <option value="5" selected>5 (推荐)</option>
              <option value="8">8 (快速)</option>
              <option value="10">10 (极速)</option>
            </select>
          </div>
          <div class="setting-item">
            <label class="setting-checkbox">
              <input type="checkbox" id="autoTranslate">
              <span class="checkmark"></span>
              页面加载时自动翻译
            </label>
          </div>
        </div>
      </div>

      <!-- 快捷操作 -->
      <div class="control-section">
        <div class="quick-actions">
          <button id="translatePageBtn" class="action-btn primary">
            <span class="btn-icon">🌐</span>
            <span class="btn-text">翻译当前页面</span>
            <span class="btn-shortcut">Alt+W</span>
          </button>
          <button id="clearTranslationBtn" class="action-btn secondary">
            <span class="btn-icon">🗑️</span>
            <span class="btn-text">清除翻译</span>
            <span class="btn-shortcut">Alt+C</span>
          </button>
        </div>
      </div>


    </main>

    <!-- 底部信息 -->
    <footer class="popup-footer">
      <div class="usage-stats">
        <span class="stat-icon">📊</span>
        <span id="usageCount">今日翻译: 0 次</span>
      </div>
      <div class="footer-links">
        <a href="#" id="settingsLink" title="高级设置">⚙️</a>
        <a href="#" id="helpLink" title="使用帮助">❓</a>
        <a href="#" id="feedbackLink" title="意见反馈">💌</a>
      </div>
    </footer>

    <!-- 性能指标显示 -->
    <div class="performance-info" id="performanceInfo" style="display: none;">
      <div class="perf-item">
        <span class="perf-label">翻译速度:</span>
        <span class="perf-value" id="translationSpeed">--</span>
      </div>
      <div class="perf-item">
        <span class="perf-label">成功率:</span>
        <span class="perf-value" id="successRate">--</span>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>